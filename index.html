<!DOCTYPE html>
<html>
<head>
	<title>emily chu</title>
	<meta property="og:image" content="assets/cover.png">
	<link rel="image_src" href="assets/cover.png">
	<meta name="description" content="emily is a data & interaction designer">
		<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41817854-5"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-41817854-5');
	</script>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<meta name="viewport" content="width=device-width">
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700,700i,900&display=swap" rel="stylesheet">
</head>
<style>
body {
	color:#c2b59b;
	font-family:'Playfair Display', sans-serif;
	top:0;
	left:0;
	margin:0;
	display:flex;
	flex-wrap:wrap;
	align-items:center;
	justify-content: center;
}
#gallery {
	margin-top:3%;
	text-align:center;
	max-width:100%;
}
.section {
	margin:5% 0%;
	width:100%;
	text-align:center;
	justify-content:center;
	animation:1s fadeIn ease-in-out;
}
.section h1 {
	font-weight: 300;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #231F20;
    font-size: 1em;
}
portrait-card, landscape-card {
	text-align:left;
	background-color:#F2f2f2;
	width:40%;
	margin:2%;
	line-height:0em;
	animation:2s fadeIn ease-in-out;
	transition:0.25s ease-in-out;
}
landscape-card:hover, portrait-card:hover {
		box-shadow:0em -0.3em 1em #c2b59b;
}
portrait-card {
	position:relative;
	width:25%;
    height:80vh;
    overflow:hidden;
    display:inline-block;
    background-color:transparent;
}
byline {
    font-size:0.5em;
    font-style:italic;
    padding-top:2%;
}
portrait-card .excerpt {
	position:absolute;
    width:100%;
    height:100%;
    background-color:white;
    opacity:0;
    transition:0.25s ease-in;
    z-index:2;
    line-height:1.5em;
}

.overlay-bounding {
	width:auto;
   height:100%;
   overflow:hidden;
   position:relative;
}

portrait-card p {
    position: relative;
    float: left;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin:auto;
    vertical-align:middle;
    text-align:left;
    font-size:1.5em;
    font-weight:200;
    width:80%;
}
portrait-card:hover .excerpt {
    opacity:0.95;
}
img {
	width:100%;
}
h4 {
	color:#231F20;
	font-weight:100;
	font-size:1.5em;
	line-height:1em;
}
p {
	color:#231F20;
	font-size:0.8em;
}
#writing_on_the_wall {
	top:0%;
	right:10%;
	position:fixed;
	z-index:1;
	font-size:4em;
	margin:0%;
	cursor:pointer;
	transition:0.25s ease-in;
}
#writing_on_the_wall:hover {
	color:#231F20;
}
@keyframes fadeIn {
	0% {
		opacity:0;
	}
	100% {
		opacity:1;
	}
}
.watcher {
	color:white;
	width:100%;
	height:10vh;
	bottom:0;
	position:absolute;
	float:left;
	font-size:3em;
}
.watcher div {
	background-color:#c2b59b;
	animation: 1.5s load ease-in;
	height:100%;
}
@keyframes load {
	0% {
		width:0%;
	}
	100% {
		width:100%;
	}
}
.lightbox {
    top:0;
    left:0;
    margin:0;
    padding:0;
    position:fixed;
    z-index:200;
    width:100%;
    height:100%;
    background-color:white;
    display:none;
}
.lightbox-frame {
/*    background-color:red;*/
    width:50%;
    height:50%;
    margin-left:auto;
    margin-right:auto;
    margin-top:12.5%;
}
.close {
    position:absolute;
    right:1%;
    margin:2%;
    font-weight:900;
    padding:1%;
    font-family: 'Playfair Display', serif;
    color:#c2b59b;
    border:0.05em solid #c2b59b;
    width:1%;
    cursor:pointer;

}
.close:hover {
    background-color:#231F20;
    border:0.05em solid #231F20;
    color:white;
}

#secret {
    display:none;
    position:fixed;
    background-color:white;
    width:100%;
    height:100vh;
    z-index:2000;
    top:0;
    left:0;
    font-weight:400;
}
.center_form {
    position: relative;
    float: left;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin:auto;
    vertical-align:middle;
    text-align:center;
    font-size:1.5em;
    font-weight:200;
    width:50%;

}
input[type="text"]{
    font-size:1em;
    padding:1%;
    color:#CCC;
    border: none;
    border-bottom:0.05em solid;
}
input[type="submit"]{
    background-color:#c2b59b;
    font-family: 'Playfair Display', serif;
    font-weight:900;
    font-size:0.6em;
/*    letter-spacing:0.05em;*/
    color:white;
    border:none;
    padding:3%;
    cursor:pointer;
    transition:0.25s all;
/*    text-transform:uppercase;*/
}
input[type="submit"]:hover{
    background-color:#231F20;
}
.center_form .close {
    font-size:0.8em;
    background-color:#c2b59b;
    color:white;
    padding:1%;
    width:auto;
}
.center_form .close:hover {
    color:#231F20;
    border: 0.05em solid #231F20;
    background-color:white;
}

ellipsis:after {
  overflow: hidden;
  display: inline-block;
  vertical-align: bottom;
  -webkit-animation: ellipsis steps(4,end) 900ms infinite;      
  animation: ellipsis steps(4,end) 900ms infinite;
  content: "\2026"; /* ascii code for the ellipsis character */
  width: 0em;
  opacity:0;
  transition:0.25s all ease-in-out;
}

@keyframes ellipsis {
  to {
    width: 1.5em;   
    opacity:1; 
  }
}

@-webkit-keyframes ellipsis {
  to {
    width: 1.5em;    
  }
}

#notification {
    position:fixed;
    z-index:5;
    width:5%;
    bottom:5%;
    right:3%;
    cursor:pointer;
    background-color:white;
    border-radius:50%;
    box-shadow: 0.5em 0.5em 2em #666666;
    padding:1%;
    transition:0.25s all;
}

@keyframes jump {
    0% {
        transform:rotate(45deg);
        transform:translateY(0px);
    }
    25% {
        transform:rotate(-25deg);
    }
    70% {
        transform:rotate(45deg);
        transform:translateY(-50px);
    }
    90% {
        transform:rotate(-25deg);
        transform:translateY(0px);

    }
    100% {
        transform:rotate(0deg);

    }
}

#notification img {
    width:100%;
    margin:auto;
    text-align:center;
    transition:0.25s all;
    animation: jump 0.7s 3 cubic-bezier(0,0.5,0.8,1);
    animation-delay: 0.5s;
    animation-fill-mode: forwards;
}
#notification:hover {
    transform:scale(1.5);
    transform-origin: 50% 50%;
    background-color:#FF8E69;
}
@media screen and (max-width:767px){
	#writing_on_the_wall{
		font-size:1.5em;
	}
	landscape-card, portrait-card{
		width:80%;
		margin:7% 5%;
	}
	#gallery {
		margin-top:25%;
	}
	#writing_on_the_wall {
		font-size:2.5em;
	}
    #notification {
	    width:15%;
	    right:5%;
	    bottom:2%;
	}
    .close {
        padding:3% 6% 3% 5%;
    }
    .center_form .close {
        font-size:0.8em;
        top:-5%;
        padding:3% 5%;
    }
    input[type="submit"]{
        margin-top:5%;
        font-size:1.2em;
        padding:5%;
    }
}
</style>
<body>
<!-- secret message-->
<div id="secret">
	<div class="close" id="close_prompt">X</div>
	<div class="center_form" id="form1">
		  <h3>Emily may have a secret message waiting for you. Who is visiting today?</h3>
		  <input type="text" name="name" value="i.e. Rad Person" onClick="this.setSelectionRange(0, this.value.length)">
		  <br><br>
		  <input type="submit" value="Submit">
	</div> 
</div>

<!-- notification -->
<div id="notification">
	<img src="assets/notification2.png">
</div>

<!-- content -->
<h1 id='writing_on_the_wall'>emily chu</h1>
<div id='gallery'></div>
</body>

<script type="text/javascript">

let path = 'data.csv'
	body = document.querySelector('body')
	gallery = document.querySelector('#gallery')
	watcher1 = document.createElement('div')
	watcher1.setAttribute('id','watcher')
	watcher1.setAttribute('class','watcher')
	watcher1.innerHTML="<div> </div>"
	body.appendChild(watcher1)
	about = document.querySelector('#writing_on_the_wall')

d3.csv(path)
.then(function(data){
	createSections(data)
	setTimeout(function() {
		populate(data)
		setImgAspect()
		watcher1.style.display="none"
	},1500)

})
.catch(function(error){
})

window.onresize=function() {
	setImgAspect()
}

about.onclick=function() {
	window.location.replace('pages/about.html');
}

// helpers
   function titleCase(string) {
      var sentence = string.toLowerCase().split(" ");
      for(var i = 0; i< sentence.length; i++){
         sentence[i] = sentence[i][0].toUpperCase() + sentence[i].slice(1);
      }
   document.write(sentence.join(" "));
   return sentence;
   }

function shuffle(array) {
  array.sort(() => Math.random() - 0.5);
}


function createSections(data){
	const unique = (value, index, self) => {
	  return self.indexOf(value) === index
	}
	let sections = []
	data.forEach(function(item){
		sections.push(item['section'])
	})
	unique_sections = sections.filter(unique)
	unique_sections.forEach(function(item){
		div = document.createElement('div')
		div.setAttribute('class','section')
		div.setAttribute('id',item)
		h1 = document.createElement('h1')
		h1.innerHTML=item
		div.appendChild(h1)
		gallery.appendChild(div)
	})
	watcher1.click()
	watcher1.value=1
}

function setImgAspect() {
	let imgs = document.images,
	    len = imgs.length,
	    counter = 0;

	[].forEach.call( imgs, function( img ) {
	    img.addEventListener( 'load', incrementCounter, false );
	} );
	function incrementCounter() {
	    counter++;
	    if ( counter === len ) {
	    	set1 = document.querySelectorAll('landscape-card')
	    	set1.forEach(function(item){
	    		id=item.id
	    		console.log(id)
	    		fixAspectRatio('#'+id)
	    	})
	    }
	}

	function fixAspectRatio(item){
		item = document.querySelector(item)
		img = item.querySelector('.bounding')
		caption = item.querySelector('.excerpt')
		height1= getheight(img)
		height2 = getheight(caption)
		setheight(item, height1, height2)
	}
}

function getheight(item){
	let style = item.getComputedStyle
		marginTop = parseInt(style.marginTop)
		marginBottom=parseInt(style.marginBottom)
	return item.clientHeight+marginTop+marginBottom
}

function setheight(item, height1, height2){
	item.style.height=(height1+height2)+"px"
}


function populate(data){
	let sections = document.querySelectorAll('.section')
	console.log(sections)
	sections.forEach(function(section){
		section=section.id
		section_data = data.filter(function(d){
			return d.section==section
		})
		shuffle(section_data)
		counter=0
		section_data.forEach(function(item){
			if(item['section']!='readings'){
				counter++
				a=item['a']
				img=item['img']
				h4=item['h4']
				p=item['p']

				// parent
				card = document.createElement('landscape-card')
				card.setAttribute('id',"lc-"+counter)
				// link
				link = document.createElement('a')
				link.setAttribute('slot','lc-slot-1')
				link.href=a
				link.setAttribute('target',"_blank")
				link.setAttribute('slot','lc-slot-1')
				// bounded img
				bounding = document.createElement('div')
				bounding.setAttribute('class','bounding')
				b1 = document.createElement('img')
				b1.setAttribute('slot','lc-slot-2')
				b1.src=img
				// excerpt with h4 and p
				excerpt = document.createElement('div')
				excerpt.setAttribute('class','excerpt')
				e1 = document.createElement('h4')
				e1.setAttribute('slot','lc-slot-3')
				e1.style.margin="0%"
				e1.style.padding="5% 0%"
				e2 = document.createElement('p')
				e2.setAttribute('slot','lc-slot-3')
				e1.innerHTML=h4
				e2.innerHTML=p
				target=document.querySelector("#"+section)
				bounding.appendChild(b1)
				excerpt.appendChild(e1)
				excerpt.appendChild(e2)
				card.appendChild(bounding)
				card.appendChild(excerpt)
				link.appendChild(card)
				target.appendChild(link)
			} else {
			counter++
			a=item['a']
			img=item['img']
			h4=item['h4']
			p=item['p']

			// parent
			card = document.createElement('portrait-card')
			card.setAttribute('id',"lc-"+counter)
			// link
			link = document.createElement('a')
			link.setAttribute('slot','lc-slot-1')
			link.href=a
			link.setAttribute('target',"_blank")
			link.setAttribute('slot','lc-slot-1')
			// bounded img
			bounding = document.createElement('div')
			bounding.setAttribute('class','overlay-bounding')
			b1 = document.createElement('img')
			b1.setAttribute('slot','lc-slot-2')
			b1.src=img
			// excerpt with h4 and p
			excerpt = document.createElement('div')
			excerpt.setAttribute('class','excerpt')
			e1 = document.createElement('h4')
			e1.setAttribute('slot','lc-slot-3')
			e1.style.margin="0%"
			e1.style.padding="5% 0%"
			e2 = document.createElement('p')
			e2.setAttribute('slot','lc-slot-3')
			e1.innerHTML=h4
			e2.innerHTML=p
			target=document.querySelector("#"+section)
			bounding.appendChild(b1)
			excerpt.appendChild(e1)
			excerpt.appendChild(e2)
			card.appendChild(excerpt)
			card.appendChild(bounding)
			link.appendChild(card)
			target.appendChild(link)	
			}
			
		})
	})
}

customElements.define('landscape-card', class extends HTMLElement {
	constructor() {
		super()
		this.attachShadow({mode:'open'}).innerHTML=`
		<style>
		:host {
			display:inline-block;
			content:contain;
			width:100%;
			height:auto;
			border-radius:2em;
			overflow:hidden;
		}
		::slotted(img){
			display:block;
			height:100%;
			width:auto;
		}
		::slotted(.bounding){
			display:block;
			width:100%;
			overflow:hidden;
		}
		::slotted(.excerpt){
			display:block;
			width:90%;
			height:fit-content;
			padding:0% 5%;
			line-height:1em;
		}
		</style>
		<slot></slot>
		<slot name='lc-slot-1'><a slot='lc-slot-1' href="" target="_blank">
			<div class="bounding">
				<slot name='lc-slot-2'><img name='lc-slot-2' class ="media-cover" src=""></slot>
			</div>
			<div class="excerpt">
				<slot name-'lc-slot-3'><h4 name='lc-slot-3'></h4></slot>
				<slot name='lc-slot-4'><p name='lc-slot-4'></p></slot>
			</div>
		</a></slot>
		`
	}
})

customElements.define('portrait-card', class extends HTMLElement {
	constructor() {
		super()
		this.attachShadow({mode:'open'}).innerHTML=`
		<style>
		:host {
			display:inline-block;
			position:relative;
			content:contain;
			width:100%;
			height:auto;
			border-radius:2em;
			overflow:hidden;
			background-color:transparent;
		}
		::slotted(.bounding){
			display:block;
		}
		::slotted(.excerpt){
			display:block;
		}
		</style>
		<slot></slot>
		<slot name='lc-slot-1'><a slot='lc-slot-1' href="" target="_blank">
			<div class="excerpt">
				<slot name-'lc-slot-3'><h4 name='lc-slot-3'></h4></slot>
				<slot name='lc-slot-4'><p name='lc-slot-4'></p></slot>
			</div>
			<div class="bounding">
				<slot name='lc-slot-2'><img name='lc-slot-2' class ="media-cover" src=""></slot>
			</div>
		</a></slot>
		`
	}
})

function toTitleCase(str) {
    return str.replace(
        /\w\S*/g,
        function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        }
    );
}

notification = document.querySelector('#notification');
notification.addEventListener("click", function() {
    var secret = document.querySelector('#secret');
    secret.style.display="inline-block";
    secretMessage();
})


function secretMessage() {
    var secret = document.querySelector('#secret');
    var secret_form = document.querySelector('input[type="submit"]');
    var name_field = document.querySelector('input[name="name"]');
    var name = document.querySelector('input[name="name"]').value;
    name_field.addEventListener("change", function() {
            name = document.querySelector('input[name="name"]').value;
            name = name.toLowerCase();
            console.log(name);
            if(name == "toni best"){
                document.body.style.zoom = 1.0;
                secret.innerHTML="";
                secret.innerHTML="<div class='center_form'><div class='close' id='close_message'>X</div><h2>Hi Toni,</h2><h3>Aduro makes everything possible <3 <br><br>Emily</h3></div>"
                console.log("secret message sent");
                closeMessage();
            } else if(name == "anu addanki"){
                document.body.style.zoom = 1.0;
                secret.innerHTML="";
                secret.innerHTML="<div class='center_form'><div class='close' id='close_message'>X</div><h2>Hi Anu,</h2><h3>Happy holidays<br><br>Emily</h3></div>"
                console.log("secret message sent");
                closeMessage();
            } else {
                document.body.style.zoom = 1.0;
                secret.innerHTML="";
                secret.innerHTML="<div class='center_form'><div class='close' id='close_message'>X</div><h2>Hi " + toTitleCase(name) + ",</h2><h3>Hope you find something you like and enjoy your day! :) <br><br>Emily</h3></div>"
                console.log("secret message sent");
                closeMessage();
            }
    });
};

secretMessage();

function enterNameInput() {
    var name = document.querySelector('input[name="name"]')
    var secret_form = document.querySelector('input[type="submit"]');
    name.addEventListener("keyup", function(event) {
      event.preventDefault();
      if (event.keyCode === 13) {
        secret_form.click();
      }
    });
}

enterNameInput();

var close_secret = document.querySelector('#close_prompt');
close_prompt.addEventListener("click", function() {
     document.body.style.zoom = 1.0;
     scrollToTop();
     secret.style.display="none";
})

function closeMessage() {
    var close_message = document.querySelector('#close_message');
    close_message.addEventListener("click", function() {
         document.body.style.zoom = 1.0;
         scrollToTop();
         secret.style.display="none";
    })
};


function scrollToTop() {
    var body = document.querySelector('body')
    body.scrollTop = 0;
}
	
</script>
</html>